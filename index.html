<html>
	<head>
		<link rel="stylesheet"  type="text/css" href="styles.css">
		<script type="text/javascript" src="client.js"></script>
		<title>Budget</title>
	</head>
	<body>
		<script type="text/javascript">
			
			const client = new Client("budgetclient");
			
			function calculateDailyExpenditure(remainingDays, remainingBalance) {
				const dailyAmount = (remainingBalance/remainingDays);	
				document.getElementById("daily").innerText = `Daily Expenditure: ${(Math.round(dailyAmount * 100) / 100)}`;
				document.getElementById("balance").value = remainingBalance;
			};
			
			client.subscribe("utils-api", "Utils", "getRemainingDaysInCurrentMonth", true, (data, error)=>{
				if (error) throw error;	
				client.subscribe("budget", "Balance", "setBalance", false, (data2, error2)=>{
					if (error2) throw error2;
					calculateDailyExpenditure(data.days, parseFloat(data2.balance));
				});
			});
			
			function newBalance(){
				const balance=parseFloat(document.getElementById("balance").value);
				client.publish("SetBalance", balance);
				client.publish("budget", "Balance", "calculate");
				client.publish("GetRemainingDaysInCurrentMonth");
			};
			
		</script>
		<p>Total Balance: <input type="text" id="balance" placeholder="enter total balance here..." value="" onchange="newBalance()"/></p>
		<p id="daily">Daily Expenditure: 0</p>
	</body>
</html>
