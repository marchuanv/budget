<html>
	<head>
		<link rel="stylesheet"  type="text/css" href="styles.css">
		<script type="text/javascript" src="getremoteinstance.js"></script>
		<title>Budget</title>
	</head>
	<body>
		
		<div class="loader" id="loader"></div>
		<div id="balanceform">
			<p>Month: <input type="month" id="month"></p>
			<p>Total Balance: <input type="text" id="balance" placeholder="enter total balance here..." value="" /></p>
			<p id="daily">Daily Expenditure: 0</p>
			<input type="button" id="submit" value="Submit" onclick="setBalance()">
		</div>

		<script type="text/javascript">
			document.getElementById("balanceform").style.display = "none";
			getRemoteInstance("budget", "Balance").then(async(balanceRemote) => {
				getRemoteInstance("utils-api", "Utils").then(async(utils) => {
					
					const dailyexpenditure = await balanceRemote.getDailyExpenditure();
					document.getElementById("daily").innerText = `Daily Expenditure: ${(Math.round(dailyexpenditure * 100) / 100)}`;
					
					const remainingbalance = await balanceRemote.getBalance();
					document.getElementById("balance").value = remainingbalance;

					const month = await balanceRemote.getMonth();
					const year = await balanceRemote.getYear();

					document.getElementById("month").value = `${year}-${('0' + month).slice(-2)}`;

					document.getElementById("balanceform").style.display = "block";
					document.getElementById("loader").style.display = "none";

					window.setBalance = async () => {
						const monthYear=document.getElementById("month").value.split("-");
						const remainingdays = await utils.getRemainingDays(monthYear[0], monthYear[1]);
						const newBalance=parseFloat(document.getElementById("balance").value);
						await balanceRemote.reset(remainingdays, newBalance, monthYear[1], monthYear[0]);
						location.reload();
					};
				});
			});
		</script>
		
	</body>
</html>
